name: 'Trivy Container Scan'
description: 'Scans a Docker image for vulnerabilities using Trivy.'

inputs:
  image-name:
    description: 'The name and tag of the Docker image to scan'
    required: true
  harbor-username:
    description: 'admin'
    required: true
  harbor-password:
    description: 'Horbor@2025'
    required: true
  harbor-registry:
    description: 'harbor.cloudops.terv.pro'
    required: true

runs:
  using: 'composite'
  steps:
    - name: Docker Login
      run: |
        echo "${{ inputs.harbor-password }}" | docker login ${{ inputs.harbor-registry }} \
          --username ${{ inputs.harbor-username }} \
          --password-stdin
      shell: bash

    - name: Run Trivy Scan
      uses: aquasecurity/trivy-action@0.24.0
      with:
        image-ref: ${{ inputs.image-name }}
        format: 'table'
        severity: 'HIGH,CRITICAL'
        exit-code: '1'   # Fail pipeline if HIGH/CRITICAL vulnerabilities found
